// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
    provider = "postgres"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

/**
* @see https://github.com/omar-dulaimi/prisma-zod-generator
*/
generator zod {
    provider          = "prisma-zod-generator"
    output            = "./src/generated-zod-schemas"
    isGenerateSelect  = true
    isGenerateInclude = true
}

//##################################################################################################
//##################################################################################################
//##################################################################################################
// INFRASTRUCTURE
//
// Things that are not really app data, but needed for infrastructure purposes
//##################################################################################################
//##################################################################################################
//##################################################################################################
/// The currently deployed version of the application. There should ever only be one row in this
/// table.
model ApplicationVersion {
    // @superset-ignore
    id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

    /// The deployed tag, usually a git sha, but could be any identifier
    deployTag String

    /// Time the deploy finished, marks when the last pod successfully passed a health check.
    /// Defaults to the time the row was created in the DB.
    deployedAt DateTime @default(now())
}

/**
* Represents an item in a restaurant's menu.
*/
model MenuItem {
    id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    name String
    quantity Int
    costPerItem Float?

    orderId String @db.Uuid
    order Order @relation(fields: [orderId], references: [id])
}

/**
* Represents an order made by a customer.
*/
model Order {
    id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Note that this may diverge from a summation of MenuItem due to restaurant policy.
    totalCost Float?
    pickupTime DateTime?

    restaurantName String
    restaurantPhone String

    orderItems MenuItem[]
    telephoneCall TelephoneCall?
}

enum TelephonyServiceType {
    Vapi
}

/**
* Represents a telephone call made to a telephony service.
*/
model TelephoneCall {
    id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    externalServiceType TelephonyServiceType
    externalServiceId String

    orderId String @unique @db.Uuid
    order Order @relation(fields: [orderId], references: [id])
}
